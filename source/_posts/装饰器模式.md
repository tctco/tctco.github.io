---
title: 装饰器模式
date: 2023-12-06T21:35:38.000Z
tags: null
categories: null
---

经典装饰器模式，装饰器本身是一种聚合aggregation。装饰器类和被装饰对象应该有共同接口（比如`read`和`write`）。在实现这些接口的时候，应该调用被装饰对象的方法。

方法可以被装饰（Python常见），同时类也可以被装饰！

```c++
class DataSource {
  public:
    virtual ~DataSource() {}
    virtual void writeData(std::string& data) const = 0;
    virtual std::string readData() const = 0;
};

class FileDataSource: public DataSource {
  public:
    FileDataSource(std::string& filename) {
        // get this file
    }
    void writeData(std::string& data) override {
        // write data to file
    }
    std::string readData() override {
        // read data from file
    }
};

class DataSourceDecorator: public DataSource {
  protected:
    DataSource* wrappee;
  public:
    DataSourceDecorator(DataSource* datasource): wrappee(datasource) {
      if (!datasource) {
          throw std::invalid_argument("DataSource cannot be nullptr");
        }
    }
    void writeData(std::string& data) override {
      wrappee->writeData(data);
    }
    std::string readData() override {
      return wrappee->readData(data);
    }
    virtual ~DataSourceDecorator() {
      delete wrappee;
    }
};

class EncryptionDecorator: public DataSourceDecorator {
  void writeData(std::string& data) override {
    // encrypt the data
    std::string encryptedData = encrypt(data);
    wrappee->writeData(encryptedData);
  }
  std::string readData() override {
    // decrypt data
    std::string data = wrappee->readData();
    return decrypt(data);
  }
};

class CompressionDecorator: public DataSourceDecorator {
  void writeData(std::string& data) override {
    // compress the data
    std::string encryptedData = compress(data);
    wrappee->writeData(encryptedData);
  }
  std::string readData() override {
    // decompress data
    std::string data = wrappee->readData();
    return decompress(data);
  }
};

int main(int argc, char* argv[]) {
  FileDataSource* source = new FileDataSource("file.dat");
  source->writeData("salary records");
  source = new CompressionDecorator(source);
  source->writeData("another salary records");
  source = new EncryptionDecorator(source);
  source->writeData("last salary records");
  delete source;
  return 0;
}
```
