---
title: 中介者模式
date: 2023-12-16T16:08:07.000Z
tags: null
categories: null
---

组件之间存在复杂依赖的时候，可以构造一个中介者统一管理组件之间的通讯。

```c++
class Mediator {
  public:
    virtual ~Mediator() {}
    virtual void notify(Component* sender, std::string event) = 0; 
};

class AuthenticationDialog: public Mediator {
  private:
    std::string title;
    Checkbox *loginOrRegisterChkBx;
    Textbox *loginUsername, *loginPassword;
    Textbox *registrationUsername, *registrationPassword, *registrationEmail;
    Button *okBtn, *cancelBtn;

  public:
    AuthenticationDialog() {
      // create all components by pasing the current
      // mediator into their constructors to establish links
    }
    void notify(Component* sender, std::string event) override {
      if (sender == loginOrRegisterChkBx && event == "check")
        if (loginOrRegisterChkBx->checked) title = "Log in";
        else title = "Register";
      if (sender == okBtn && event == "click")
        if (loginOrRegister->checked) {
          // try to find the user
          if (!found) // show error msg
        } else {
          // create user account and log that user in
        }

    }
};

class Component {
  Mediator* dialog;
  public:
    Component(Mediator* m): dialog(m) {}
    void click() {
      dialog->notify(this, "click");
    }
    void keypress() {
      dialog->notify(this, "keypress");
    }
};

class Button: public Component {
  // ...
};

class Textbox: public Component {
  // ...
};

class Checkbox: public Component {
  public:
    void check {
      dialog->notify(this, "check");
    }
}
```
