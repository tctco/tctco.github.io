---
title: 抽象工厂模式
date: 2023-12-01 01:23:18
tags:
categories: Design Pattern
---

> 简言之，就是业务逻辑需要创造**一套套对应的组件**。在不同条件下，需要的配套组件不同，但是这些组件都执行相似的功能。调用者直接接收一个工厂类，这个工厂类对应了一系列组件。不同的工厂制造不同的组件，但都遵循相同的接口。
>
> 换句话说，工厂实际上是对产品的一种打包！抽象工厂提供了对工厂的多态支持。

```cpp
class GUIFactory {
  public:
    virtual Button* createButton() const = 0;
    virtual Checkbox* createCheckbox() const = 0;
};

class WinFactory: public GUIFactory {
  public:
    Button* createButton() const override {
      return new WinButton();
    }

    Checkbox* createCheckbox() const override {
      return new WinCheckbox();
    }
};

class MacFactory: public GUIFactory {
  public:
    Button* createButton() const override {
      return new MacButton();
    }

    Checkbox* createCheckbox() const override {
      return new MacCheckbox();
    }
};

class Button {
  public:
    virtual void paint() const = 0;
};

class WinButton: public Button {
  public:
    void paint() const override {
      // render a windows button
    }
};

class MacButton: public Button {
  public:
    void paint() const override {
      // render a mac button
    }
};

class Checkbox {
  public:
    virtual void paint() const = 0;
};

class WinCheckbox: public Checkbox {
  public:
    void paint() const override {
      // render a windows button
    }
};

class MacCheckbox: public Checkbox {
  public:
    void paint() const override {
      // render a mac button
    }
};

class Application {
  private:
    GUIFactory* factory;
    Button* button;
  public:
    Application(GUIFactory* factory): factory(factory), button(nullptr) {}
    ~Application() {delete button;}
    void createUI() {
      delete button; // 避免重复创建button
      button = factory->createButton();
    }
    void paint() {
      button->paint();
    }
}

class ApplicationConfigurator {
  public:
    GUIFactory* factory;
    Application* app;
    ApplicationConfigurator(): factory(nullptr), app(nullptr) {}
    ~ApplicationConfigurator() {
      delete factory;
      delete app;
    }

    void setup() {
      Config config = readConfigFile();
      if (config.OS == "Win") factory = new WinFactory;
      else if (config.OS == "Mac") factory = new MacFactory;
      else throw std::runtime_error("invalid config.OS");

      app = new Application(factory);
    }

    void run() {
      if (!app) setup();
      app->createUI();
      app->paint();
      // other ui things...
    }
}
```

