---
title: 备忘录模式
date: 2023-12-17T20:25:07.000Z
tags: null
categories: null
---

允许在不暴露对象实现细节的情况下，将对象恢复到之前的状态。

- 快照对象应该是不可变对象，仅被初始化一次

快照发起者可以实现`restore(Momento* m)`方法，也可以由快照实现`restore()`方法。后者可以将快照对象与照看者对象（CareTaker）解耦。

```c++
class Editor {
  private:
    std::string text;
    int curX, curY, selectionWidth;
  public:
    void setText(std::string t) {
      text = t;
    }
    void setCursor(int x, int y) {
      curX = x;
      curY = y;
    }
    void setSelectionWdith(int w) {
      selectionWidth = w;
    }
    Snapshot* createSnapshot() {
      return new Snapshot(this, text, curX, curY, selectionWidth);
    }
};

class Snapshot {
  private:
    Editor* editor;
    std::string text;
    int curX, curY, selectionWidth;
  public:
    Snapshot(Editor* e, std::string t, int x, int y, int w): editor(e), text(t), curX(x), curY(y), selectionWidth(w) {}
    void restore() {
      editor->setText(text);
      editor->setCursor(curX, curY);
      editor->setSelectionWidth(selectionWidth);
    }
};

class Command {
  private:
    Snapshot* backup;
    Editor* editor;
  public:
    Command(Editor* e): editor(e), backup(nullptr) {}
    void makeBackup() {
      backup = editor->createSnapshot();
    }
    void undo() {
      if (backup) backup->restore();
    }
    virtual void execute() = 0;
};

class CopyCommand: public Command {
  void execute() override {
    // execute something
  }
};
```
