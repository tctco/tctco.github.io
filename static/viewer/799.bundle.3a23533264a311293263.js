"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[799],{91799:(e,t,n)=>{n.r(t),n.d(t,{default:()=>E});var a=n(32735),r=n(60216),i=n.n(r),s=n(78579),l=n(84334),o=n(18188),c=n(38942),m=n(509),u=n(76467),d=n(12200),p=n(18699);function f(){return f=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},f.apply(this,arguments)}const{formatDate:g}=s.ZP;function v(e){const{children:t,displaySets:n,viewportIndex:r,viewportLabel:i,servicesManager:s,extensionManager:v,commandsManager:E,viewportOptions:w}=e,{t:S}=(0,c.$G)("TrackedViewport"),{measurementService:b,cornerstoneViewportService:h}=s.services,y=n[0],[x]=(0,p.I)(),[{activeViewportIndex:P}]=(0,o.O_)(),[{isCineEnabled:C,cines:N},k]=(0,o.vQ)(),[T]=(0,o.en)(),[I,D]=(0,a.useState)(!1),[M,O]=(0,a.useState)(null),[R,V]=(0,a.useState)(null),{trackedSeries:A}=x.context,Z=w.viewportId,{Modality:F,SeriesDate:_,SeriesDescription:j,SeriesInstanceUID:K,SeriesNumber:W}=y,{PatientID:$,PatientName:q,PatientSex:L,PatientAge:J,SliceThickness:U,SpacingBetweenSlices:B,ManufacturerModelName:G}=y.images[0],Q=()=>{if(!N||!N[r]||!R)return;const e=N[r],t=e.isPlaying||!1,n=e.frameRate||24,a=Math.max(n,1);t?k.playClip(R,{framesPerSecond:a}):k.stopClip(R)};(0,a.useEffect)((()=>I?(d.Z.setViewportToolStyles(Z,{global:{lineDash:""}}),void h.getRenderingEngine().renderViewport(Z)):(d.Z.setViewportToolStyles(`viewport-${r}`,{global:{lineDash:"4,4"}}),h.getRenderingEngine().renderViewport(Z),()=>{d.Z.setViewportToolStyles(Z,{})})),[I]),(0,a.useEffect)((()=>(m.Z.addEventListener(u.Z.STACK_VIEWPORT_NEW_STACK,Q),()=>{k.setCine({id:r,isPlaying:!1}),m.Z.removeEventListener(u.Z.STACK_VIEWPORT_NEW_STACK,Q)})),[R]),(0,a.useEffect)((()=>{if(N&&N[r]&&R)return Q(),()=>{R&&N?.[r]?.isPlaying&&k.stopClip(R)}}),[N,r,k,R,Q]),A.includes(K)!==I&&D(!I);const Y=e=>{V(e.detail.element)};const z=N[r],H=z&&z.isPlaying||!1;return a.createElement(a.Fragment,null,a.createElement(o.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},useAltStyling:I,onArrowsClick:e=>function(e){const t=function(e,t,n,a){const{measurementService:r}=t.services,i=r.getMeasurements(),{trackedSeries:s}=a.context,l=i.filter((e=>s.includes(e.referenceSeriesUID)));if(!l.length)return;const o=l.length,c=l.map((e=>e.uid));let m=c.findIndex((e=>e===n));return-1===m?m=0:"left"===e?(m--,m<0&&(m=o-1)):"right"===e&&(m++,m===o&&(m=0)),c[m]}(e,s,M,x);t&&(O(t),b.jumpToMeasurement(r,t))}(e),getStatusComponent:()=>function(e){const t=e?"tracked":"dotted-circle";return a.createElement("div",{className:"relative"},a.createElement(o.u,{position:"bottom-left",content:a.createElement("div",{className:"flex py-2"},a.createElement("div",{className:"flex pt-1"},a.createElement(o.JO,{name:"info-link",className:"w-4 text-primary-main"})),a.createElement("div",{className:"flex ml-4"},a.createElement("span",{className:"text-base text-common-light"},e?a.createElement(a.Fragment,null,"Series is",a.createElement("span",{className:"font-bold text-white"}," tracked")," and can be viewed ",a.createElement("br",null)," in the measurement panel"):a.createElement(a.Fragment,null,"Measurements for",a.createElement("span",{className:"font-bold text-white"}," untracked "),"series ",a.createElement("br",null)," will not be shown in the ",a.createElement("br",null)," measurements panel"))))},a.createElement(o.JO,{name:t,className:"w-6 text-primary-light"})))}(I),studyData:{label:i,studyDate:g(_),currentSeries:W,seriesDescription:j,patientInformation:{patientName:q?l.ZP.utils.formatPN(q):"",patientSex:L||"",patientAge:J||"",MRN:$||"",thickness:U?`${parseFloat(U).toFixed(2)}mm`:"",spacing:void 0!==B?`${parseFloat(B).toFixed(2)}mm`:"",scanner:G||""}},showNavArrows:!C,showCine:C,cineProps:{isPlaying:H,onClose:()=>E.runCommand("toggleCine"),onPlayPauseChange:e=>k.setCine({id:P,isPlaying:e}),onFrameRateChange:e=>k.setCine({id:P,frameRate:e})}}),a.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},(()=>{const{component:t}=v.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone");return a.createElement(t,f({},e,{onElementEnabled:Y}))})(),a.createElement("div",{className:"absolute w-full"},T.viewportIndex===r&&a.createElement(o.P_,{id:T.id,message:T.message,type:T.type,actions:T.actions,onSubmit:T.onSubmit,onOutsideClick:T.onOutsideClick}))))}v.propTypes={displaySets:i().arrayOf(i().object.isRequired).isRequired,viewportIndex:i().number.isRequired,dataSource:i().object,children:i().node,customProps:i().object},v.defaultProps={customProps:{}};const E=v}}]);
//# sourceMappingURL=799.bundle.3a23533264a311293263.js.map