"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[569],{33569:(e,t,n)=>{n.r(t),n.d(t,{default:()=>w});var s=n(32735),i=n(60216),o=n.n(i),a=n(78579),r=n(84334),l=n(18188),c=n(38942);const u=function(e,t,n){const s=n.getModuleEntry("@ohif/extension-cornerstone.utilityModule.tools"),{toolNames:i,Enums:o}=s.exports,a={active:[{toolName:i.WindowLevel,bindings:[{mouseButton:o.MouseBindings.Primary}]},{toolName:i.Pan,bindings:[{mouseButton:o.MouseBindings.Auxiliary}]},{toolName:i.Zoom,bindings:[{mouseButton:o.MouseBindings.Secondary}]},{toolName:i.StackScrollMouseWheel,bindings:[]}],enabled:[{toolName:i.SegmentationDisplay}]};return e.createToolGroupAndAddTools(t,a,{})};const p=async function(e){let{segDisplaySet:t,viewportIndex:n,toolGroupId:s,servicesManager:i}=e;const{segmentationService:o,hangingProtocolService:a,viewportGridService:r}=i.services,l=t.referencedDisplaySetInstanceUID;let c=null;c=await o.createSegmentationForSEGDisplaySet(t,c,!1),o.hydrateSegmentation(t.displaySetInstanceUID);const{viewports:u}=r.getState(),p=a.getViewportsRequireUpdate(n,l);return r.setDisplaySetsForViewports(p),u.forEach(((e,i)=>{if(i===n)return;o.shouldRenderSegmentation(e.displaySetInstanceUIDs,t.displaySetInstanceUID)&&r.setDisplaySetsForViewport({viewportIndex:i,displaySetInstanceUIDs:e.displaySetInstanceUIDs,viewportOptions:{viewportType:"volume",toolGroupId:s,initialImageOptions:{preset:"middle"}}})})),!0},d={NO_NEVER:-1,CANCEL:0,HYDRATE_SEG:5};const m=function(e){let{servicesManager:t,segDisplaySet:n,viewportIndex:s,toolGroupId:i="default"}=e;const{UIViewportDialogService:o}=t.services;return new Promise((async function(e,a){const r=await function(e,t){return new Promise((function(n,s){const i="Do you want to open this Segmentation?",o=[{type:"secondary",text:"No",value:d.CANCEL},{type:"primary",text:"Yes",value:d.HYDRATE_SEG}],a=t=>{e.hide(),n(t)};e.show({viewportIndex:t,type:"info",message:i,actions:o,onSubmit:a,onOutsideClick:()=>{e.hide(),n(d.CANCEL)}})}))}(o,s);if(r===d.HYDRATE_SEG){e(await p({segDisplaySet:n,viewportIndex:s,toolGroupId:i,servicesManager:t}))}}))};var S=n(40841),g=n.n(S);function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},y.apply(this,arguments)}const{formatDate:v}=a.ZP,E="SEGToolGroup";function f(e){const{children:t,displaySets:n,viewportOptions:i,viewportIndex:o,viewportLabel:a,servicesManager:p,extensionManager:d}=e,{t:S}=(0,c.$G)("SEGViewport"),{displaySetService:f,toolGroupService:w,segmentationService:I,uiNotificationService:h}=p.services,b=`${E}-${o}`;if(n.length>1)throw new Error("SEG viewport should only have a single display set");const x=n[0],[D,N]=(0,l.O_)(),[P,T]=(0,l.en)(),[k,G]=(0,s.useState)(!1),[M,A]=(0,s.useState)(1),[C,O]=(0,s.useState)(x.isHydrated),[U,R]=(0,s.useState)(!x.isLoaded),[_,V]=(0,s.useState)(null),[L,j]=(0,s.useState)({segmentIndex:1,totalSegments:null}),B=(0,s.useRef)(null),{viewports:F,activeViewportIndex:$}=D,H=x.getReferenceDisplaySet(),Y=function(e){const t=e.images[0],n={PatientID:t.PatientID,PatientName:t.PatientName,PatientSex:t.PatientSex,PatientAge:t.PatientAge,SliceThickness:t.SliceThickness,StudyDate:t.StudyDate,SeriesDescription:t.SeriesDescription,SeriesInstanceUID:t.SeriesInstanceUID,SeriesNumber:t.SeriesNumber,ManufacturerModelName:t.ManufacturerModelName,SpacingBetweenSlices:t.SpacingBetweenSlices};return n}(H);B.current={displaySet:H,metadata:Y};const Z=e=>{V(e.detail.element)},q=()=>{V(null)},J=(0,s.useCallback)((()=>{const{component:t}=d.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{displaySet:n}=B.current;return s.createElement(t,y({},e,{displaySets:[n,x],viewportOptions:{viewportType:"volume",toolGroupId:b,orientation:i.orientation,viewportId:i.viewportId},onElementEnabled:Z,onElementDisabled:q}))}),[o,x,b]),W=(0,s.useCallback)((e=>{e="left"===e?-1:1;const t=x.displaySetInstanceUID,n=I.getSegmentation(t),{segments:s}=n,i=Object.keys(s).length;let o=M+e;o>i-1?o=1:0===o&&(o=i-1),I.jumpToSegmentCenter(t,o,b),A(o)}),[M]);(0,s.useEffect)((()=>{U||m({servicesManager:p,viewportIndex:o,segDisplaySet:x}).then((e=>{e&&O(!0)}))}),[p,o,x,U]),(0,s.useEffect)((()=>{const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENTATION_PIXEL_DATA_CREATED,(e=>{e.segDisplaySet.displaySetInstanceUID===x.displaySetInstanceUID&&R(!1),e.overlappingSegments&&h.show({title:"Overlapping Segments",message:"Overlapping segments detected which is not currently supported",type:"warning"})}));return()=>{e()}}),[x]),(0,s.useEffect)((()=>{const{unsubscribe:e}=I.subscribe(I.EVENTS.SEGMENT_PIXEL_DATA_CREATED,(e=>{let{segmentIndex:t,numSegments:n}=e;j({segmentIndex:t,totalSegments:n})}));return()=>{e()}}),[x]),(0,s.useEffect)((()=>{const e=f.subscribe(f.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=F[$];t.includes(n.displaySetInstanceUID)&&N.setDisplaySetsForViewport({viewportIndex:$,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{let e=w.getToolGroup(b);if(!e)return e=u(w,b,d),G(!0),()=>{I.removeSegmentationRepresentationFromToolGroup(b),w.destroyToolGroup(b)}}),[]),(0,s.useEffect)((()=>(O(x.isHydrated),()=>{I.removeSegmentationRepresentationFromToolGroup(b),B.current=null})),[x]);let X=null;if(!B.current||H.displaySetInstanceUID!==B.current.displaySet.displaySetInstanceUID)return null;t&&t.length&&(X=t.map(((e,t)=>e&&s.cloneElement(e,{viewportIndex:o,key:t}))));const{PatientID:z,PatientName:K,PatientSex:Q,PatientAge:ee,SliceThickness:te,ManufacturerModelName:ne,StudyDate:se,SeriesDescription:ie,SpacingBetweenSlices:oe,SeriesNumber:ae}=B.current.metadata,re=()=>{m({servicesManager:p,viewportIndex:o,segDisplaySet:x}).then((e=>{e&&O(!0)}))};return s.createElement(s.Fragment,null,s.createElement(l.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:W,getStatusComponent:()=>function(e){let{isHydrated:t,onPillClick:n}=e,i=null,o=null;switch(t){case!0:o=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 rounded-full",style:{width:"18px",height:"18px",backgroundColor:"#98e5c1",border:"solid 1.5px #000000"}},s.createElement(l.JO,{name:"exclamation",style:{color:"#000",width:"12px",height:"12px"}})),i=()=>s.createElement("div",null,"This Segmentation is loaded in the segmentation panel");break;case!1:o=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 bg-white rounded-full group-hover:bg-customblue-200",style:{width:"18px",height:"18px",border:"solid 1.5px #000000"}},s.createElement(l.JO,{name:"arrow-left",style:{color:"#000",width:"14px",height:"14px"}})),i=()=>s.createElement("div",null,"Click to load segmentation.")}const a=()=>s.createElement("div",{className:g()("group relative flex items-center justify-center px-8 rounded-full cursor-default bg-customgreen-100",{"hover:bg-customblue-100":!t,"cursor-pointer":!t}),style:{height:"24px",width:"55px"},onClick:()=>{t||n&&n()}},s.createElement("div",{className:"pr-1 text-base font-medium leading-none text-black"},"SEG"),s.createElement(o,null));return s.createElement(s.Fragment,null,i&&s.createElement(l.u,{content:s.createElement(i,null),position:"bottom-left"},s.createElement(a,null)),!i&&s.createElement(a,null))}({isHydrated:C,onPillClick:re}),studyData:{label:a,useAltStyling:!0,studyDate:v(se),currentSeries:ae,seriesDescription:`SEG Viewport ${ie}`,patientInformation:{patientName:K?r.ZP.utils.formatPN(K.Alphabetic):"",patientSex:Q||"",patientAge:ee||"",MRN:z||"",thickness:te?`${te.toFixed(2)}mm`:"",spacing:void 0!==oe?`${oe.toFixed(2)}mm`:"",scanner:ne||""}}}),s.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},U&&s.createElement(l.LE,{className:"w-full h-full",progress:null!==L.totalSegments?(L.segmentIndex+1)/L.totalSegments*100:null,textBlock:L.totalSegments?s.createElement("span",{className:"text-white text-sm flex items-baseline space-x-2"},s.createElement("div",null,"Loading Segment"),s.createElement("div",{className:"w-3"},`${L.segmentIndex}`),s.createElement("div",null,"/"),s.createElement("div",null,`${L.totalSegments}`)):s.createElement("span",{className:"text-white text-sm"},"Loading SEG ...")}),J(),s.createElement("div",{className:"absolute w-full"},P.viewportIndex===o&&s.createElement(l.P_,{id:"viewport-notification",message:P.message,type:P.type,actions:P.actions,onSubmit:P.onSubmit,onOutsideClick:P.onOutsideClick})),X))}f.propTypes={displaySets:o().arrayOf(o().object),viewportIndex:o().number.isRequired,dataSource:o().object,children:o().node,customProps:o().object},f.defaultProps={customProps:{}};const w=f}}]);
//# sourceMappingURL=569.bundle.8addeb63e01577e2a1a9.js.map