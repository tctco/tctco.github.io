"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([[953],{27953:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var s=n(32735),a=n(60216),r=n.n(a),i=n(78579),l=n(84334),o=n(38942),c=n(94709),u=n(18188),d=n(40841),p=n.n(d),m=n(68525);function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},S.apply(this,arguments)}const{formatDate:g}=i.ZP,y="@ohif/extension-measurement-tracking",h="SRToolGroup";function f(e){const{children:t,dataSource:n,displaySets:a,viewportIndex:r,viewportLabel:i,servicesManager:d,extensionManager:f}=e,{t:I}=(0,o.$G)("SRViewport"),{displaySetService:x,cornerstoneViewportService:b,measurementService:w}=d.services;if(a.length>1)throw new Error("SR viewport should only have a single display set");const E=a[0],[D,v]=(0,u.O_)(),[k,P]=(0,u.en)(),[M,C]=(0,s.useState)(0),[N,U]=(0,s.useState)(1),[T,O]=(0,s.useState)(null),[R,j]=(0,s.useState)(null),[V,A]=(0,s.useState)(E.isHydrated),[F,_]=(0,s.useState)(null),{viewports:L,activeViewportIndex:B}=D;let $,G;if(f.registeredExtensionIds.includes(y)){const e=f.getModuleEntry("@ohif/extension-measurement-tracking.contextModule.TrackedMeasurementsContext"),t=(0,s.useContext)(e.context);$=t?.[0],G=t?.[1]}G||($=null,G=(e,t)=>{let{displaySetInstanceUID:n}=t;w.clearMeasurements();const{SeriesInstanceUIDs:s}=(0,m.Z)({servicesManager:d,extensionManager:f},n),a=x.getDisplaySetsForSeries(s[0]);a.length&&v.setDisplaySetsForViewport({viewportIndex:B,displaySetInstanceUIDs:[a[0].displaySetInstanceUID]})});const H=(0,s.useCallback)((e=>{const{measurements:t}=E;(0,c.l2)(F,t.map((e=>e.TrackingUniqueIdentifier)),e)}),[F,M,E]),J=e=>{_(e.detail.element)},Y=(0,s.useCallback)((e=>{const{StudyInstanceUID:t,displaySetInstanceUID:n,sopClassUids:s}=E;t&&n&&(s&&s.length>1&&console.warn("More than one SOPClassUID in the same series is not yet supported."),async function(e,t,n){const{measurements:s}=e,a=s[t],{displaySetInstanceUID:r}=a,i=n.getDisplaySetByUID(r),l=i.images[0],o={PatientID:l.PatientID,PatientName:l.PatientName,PatientSex:l.PatientSex,PatientAge:l.PatientAge,SliceThickness:l.SliceThickness,StudyDate:l.StudyDate,SeriesDescription:l.SeriesDescription,SeriesInstanceUID:l.SeriesInstanceUID,SeriesNumber:l.SeriesNumber,ManufacturerModelName:l.ManufacturerModelName,SpacingBetweenSlices:l.SpacingBetweenSlices};return{referencedDisplaySetMetadata:o,referencedDisplaySet:i}}(E,e,x).then((t=>{let{referencedDisplaySet:n,referencedDisplaySetMetadata:s}=t;if(C(e),O(n),j(s),n.displaySetInstanceUID===T?.displaySetInstanceUID){const{measurements:t}=E,n=b.getViewportInfoByIndex(r),s=b.getCornerstoneViewport(n.getViewportId()),a=s.getImageIds().indexOf(t[e].imageId);-1!==a&&s.setImageIdIndex(a)}})))}),[n,E,T,r]),Z=(0,s.useCallback)((()=>{if(!T)return null;const{component:t}=f.getModuleEntry("@ohif/extension-cornerstone.viewportModule.cornerstone"),{measurements:n}=E,a=n[M];if(!a)return null;const r=T.images.findIndex((e=>e.imageId===a.imageId));return s.createElement(t,S({},e,{displaySets:[T],viewportOptions:{toolGroupId:`${h}`},onElementEnabled:J,initialImageIndex:r}))}),[T,r,M]),q=(0,s.useCallback)((e=>{let t=M;"right"===e?(t++,t>=N&&(t=0)):(t--,t<0&&(t=N-1)),H(t),Y(t)}),[M,N,Y,H]);(0,s.useEffect)((()=>{const e=x.subscribe(x.EVENTS.DISPLAY_SETS_REMOVED,(e=>{let{displaySetInstanceUIDs:t}=e;const n=L[B];t.includes(n.displaySetInstanceUID)&&v.setDisplaySetsForViewport({viewportIndex:B,displaySetInstanceUIDs:[]})}));return()=>{e.unsubscribe()}}),[]),(0,s.useEffect)((()=>{E.isLoaded||E.load(),A(E.isHydrated);const e=E.measurements.length;U(e)}),[E]),(0,s.useEffect)((()=>{F&&E.isLoaded&&H(M)}),[M,F,H,E]);let z=$?.context?.trackedSeries?.length>0;(0,s.useEffect)((()=>{z=$?.context?.trackedSeries?.length>0}),[$]),(0,s.useEffect)((()=>{Y(M)}),[n,E]);let K=null;if(!T||!R)return null;t&&t.length&&(K=t.map(((e,t)=>e&&s.cloneElement(e,{viewportIndex:r,key:t}))));const{PatientID:Q,PatientName:W,PatientSex:X,PatientAge:ee,SliceThickness:te,ManufacturerModelName:ne,StudyDate:se,SeriesDescription:ae,SpacingBetweenSlices:re,SeriesNumber:ie}=R;return s.createElement(s.Fragment,null,s.createElement(u.uY,{onDoubleClick:e=>{e.stopPropagation(),e.preventDefault()},onArrowsClick:q,getStatusComponent:()=>function(e){let{srDisplaySet:t,viewportIndex:n,isRehydratable:a,isLocked:r,sendTrackedMeasurementsEvent:i}=e;const l=()=>{i("RESTORE_PROMPT_HYDRATE_SR",{displaySetInstanceUID:t.displaySetInstanceUID,viewportIndex:n})},o=a&&!r?3:a&&r?2:1;let c=null,d=null;switch(o){case 1:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 rounded-full",style:{width:"18px",height:"18px",backgroundColor:"#98e5c1",border:"solid 1.5px #000000"}},s.createElement(u.JO,{name:"exclamation",style:{color:"#000",width:"12px",height:"12px"}})),c=()=>s.createElement("div",null,"This structured report is not compatible",s.createElement("br",null),"with this application.");break;case 2:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 bg-black rounded-full",style:{width:"18px",height:"18px"}},s.createElement(u.JO,{name:"lock",style:{color:"#05D97C",width:"8px",height:"11px"}})),c=()=>s.createElement("div",null,"This structured report is currently read-only",s.createElement("br",null),"because you are tracking measurements in",s.createElement("br",null),"another viewport.");break;case 3:d=()=>s.createElement("div",{className:"flex items-center justify-center -mr-1 bg-white rounded-full group-hover:bg-customblue-200",style:{width:"18px",height:"18px",border:"solid 1.5px #000000"}},s.createElement(u.JO,{name:"arrow-left",style:{color:"#000",width:"14px",height:"14px"}})),c=()=>s.createElement("div",null,"Click to restore measurements.")}const m=()=>s.createElement("div",{className:p()("group relative flex items-center justify-center px-2 rounded-full cursor-default bg-customgreen-100",{"hover:bg-customblue-100":3===o,"cursor-pointer":3===o}),style:{height:"24px",width:"55px"},onClick:()=>{3===o&&l&&l()}},s.createElement("span",{className:"pr-1 text-lg font-bold leading-none text-black"},"SR"),s.createElement(d,null));return s.createElement(s.Fragment,null,c&&s.createElement(u.u,{content:s.createElement(c,null),position:"bottom-left"},s.createElement(m,null)),!c&&s.createElement(m,null))}({srDisplaySet:E,viewportIndex:r,isTracked:!1,isRehydratable:E.isRehydratable,isLocked:z,sendTrackedMeasurementsEvent:G}),studyData:{label:i,useAltStyling:!0,studyDate:g(se),currentSeries:ie,seriesDescription:ae||"",patientInformation:{patientName:W?l.ZP.utils.formatPN(W.Alphabetic):"",patientSex:X||"",patientAge:ee||"",MRN:Q||"",thickness:te?`${te.toFixed(2)}mm`:"",spacing:void 0!==re?`${re.toFixed(2)}mm`:"",scanner:ne||""}}}),s.createElement("div",{className:"relative flex flex-row w-full h-full overflow-hidden"},Z(),s.createElement("div",{className:"absolute w-full"},k.viewportIndex===r&&s.createElement(u.P_,{message:k.message,type:k.type,actions:k.actions,onSubmit:k.onSubmit,onOutsideClick:k.onOutsideClick})),K))}f.propTypes={displaySets:r().arrayOf(r().object),viewportIndex:r().number.isRequired,dataSource:r().object,children:r().node,customProps:r().object},f.defaultProps={customProps:{}};const I=f}}]);
//# sourceMappingURL=953.bundle.b7e6d58a8adc8c9ba4d4.js.map